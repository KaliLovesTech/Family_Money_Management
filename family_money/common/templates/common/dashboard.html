{% extends 'base.html' %}
<!-- prettier ignore -->
{% block title %}Dashboard - Family Money{% endblock %}
<!-- prettier ignore -->
{% block content %}
<div class="container mt-5">
  <h1>Dashboard</h1>
  <p class="lead">Overview of your financial activities.</p>

  <!-- Account Balances Section -->
  <div class="row mt-4">
    <div class="col-md-4">
      <div class="card text-white bg-primary mb-3">
        <div class="card-header">Checking Account</div>
        <div class="card-body">
          <h5 class="card-title">$5,678.90</h5>
          <p class="card-text">Available balance.</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-success mb-3">
        <div class="card-header">Savings Account</div>
        <div class="card-body">
          <h5 class="card-title">$3,456.78</h5>
          <p class="card-text">Towards your savings goals.</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-warning mb-3">
        <div class="card-header">Investment Account</div>
        <div class="card-body">
          <h5 class="card-title">$10,789.01</h5>
          <p class="card-text">Current portfolio value.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Investment Portfolio Section -->
  <div class="mt-5">
    <h3>Investment Portfolio</h3>
    <div class="row">
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-header">Portfolio Breakdown</div>
          <div class="card-body">
            <canvas id="investmentChart"></canvas>
            <p class="card-text mt-3">
              Overview of your investment distribution.
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card mb-3">
          <div class="card-header">Performance Summary</div>
          <div class="card-body">
            <p class="card-text">
              <strong>Total Investment:</strong> $10,789.01
            </p>
            <p class="card-text">
              <strong>Year-to-Date Gain:</strong> +$1,234.56
            </p>
            <p class="card-text"><strong>Top Performer:</strong> S&P 500 ETF</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Stock Buy/Sell Recommendation Section -->
  <div class="mt-5">
    <h3>Stock Buy/Sell Recommendations</h3>
    <div id="stock-recommendation">
      <p>Loading recommendations...</p>
    </div>
  </div>

  <!-- Personal Finance Insights Section -->
  <div class="mt-5">
    <h3>Personal Finance Insights</h3>
    <p>
      You’re on track to save $1,200 this month, which is 20% more than last
      month.
    </p>
  </div>

  <!-- Chatbot Section -->
  <div class="mt-5">
    <h3>Finance Chatbot</h3>
    <div class="chatbot-container">
      <!-- Textarea for multiline input -->
      <textarea
        id="chatbot-query"
        class="form-control mb-2"
        placeholder="Ask me anything about finance..."
      ></textarea>

      <!-- Button to trigger the chatbot response -->
      <button id="chatbot-submit" class="btn btn-primary">Ask</button>

      <!-- Div to display chatbot responses -->
      <div id="chatbot-response" class="mt-3"></div>
      <div id="chatbox" class="mt-3"></div>
    </div>
  </div>

  <!-- Recent Transactions Section -->
  <div class="mt-5">
    <h3>Recent Transactions</h3>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Date</th>
          <th>Description</th>
          <th>Category</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>2024-08-30</td>
          <td>Grocery Store</td>
          <td>Groceries</td>
          <td>-$123.45</td>
        </tr>
        <tr>
          <td>2024-08-29</td>
          <td>Salary</td>
          <td>Income</td>
          <td>$2,000.00</td>
        </tr>
        <tr>
          <td>2024-08-28</td>
          <td>Electric Bill</td>
          <td>Utilities</td>
          <td>-$150.00</td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Savings Goals Progress Section -->
  <div class="mt-5">
    <h3>Savings Goals Progress</h3>
    <div class="progress mb-3">
      <div
        class="progress-bar progress-bar-striped progress-bar-animated bg-success"
        role="progressbar"
        style="width: 70%"
        aria-valuenow="70"
        aria-valuemin="0"
        aria-valuemax="100"
      >
        70% - Vacation Fund
      </div>
    </div>
    <div class="progress mb-3">
      <div
        class="progress-bar progress-bar-striped progress-bar-animated bg-info"
        role="progressbar"
        style="width: 45%"
        aria-valuenow="45"
        aria-valuemin="0"
        aria-valuemax="100"
      >
        45% - Emergency Fund
      </div>
    </div>
    <div class="progress mb-3">
      <div
        class="progress-bar progress-bar-striped progress-bar-animated bg-warning"
        role="progressbar"
        style="width: 25%"
        aria-valuenow="25"
        aria-valuemin="0"
        aria-valuemax="100"
      >
        25% - New Car Fund
      </div>
    </div>
  </div>

  <!-- Upcoming Bills Section -->
  <div class="mt-5">
    <h3>Upcoming Bills</h3>
    <ul class="list-group">
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        Rent - $1,200.00
        <span class="badge bg-danger rounded-pill">Due in 5 days</span>
      </li>
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        Internet - $50.00
        <span class="badge bg-warning rounded-pill">Due in 10 days</span>
      </li>
      <li
        class="list-group-item d-flex justify-content-between align-items-center"
      >
        Credit Card - $200.00
        <span class="badge bg-danger rounded-pill">Due in 15 days</span>
      </li>
    </ul>
  </div>

  <!-- Budget Overview Section -->
  <div class="mt-5">
    <h3>Budget Overview</h3>
    <div class="card">
      <div class="card-body">
        <h5 class="card-title">Monthly Budget</h5>
        <p class="card-text">
          You’ve spent $2,500 out of your $3,000 budget this month.
        </p>
        <div class="progress">
          <div
            class="progress-bar bg-success"
            role="progressbar"
            style="width: 83%"
            aria-valuenow="83"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            83%
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Historical Data Section -->
  <div class="mt-5">
    <h3>Historical Data</h3>
    <canvas id="historicalChart"></canvas>
  </div>
</div>
{% endblock %}
<!-- prettier ignore -->
{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // Investment Portfolio Breakdown Chart
  var ctx = document.getElementById("investmentChart").getContext("2d");
  var investmentChart = new Chart(ctx, {
    type: "doughnut",
    data: {
      labels: ["Stocks", "Bonds", "Real Estate", "Commodities", "Cash"],
      datasets: [
        {
          label: "Investment Portfolio",
          data: [50, 20, 15, 10, 5],
          backgroundColor: [
            "rgba(54, 162, 235, 0.2)",
            "rgba(75, 192, 192, 0.2)",
            "rgba(255, 206, 86, 0.2)",
            "rgba(153, 102, 255, 0.2)",
            "rgba(255, 99, 132, 0.2)",
          ],
          borderColor: [
            "rgba(54, 162, 235, 1)",
            "rgba(75, 192, 192, 1)",
            "rgba(255, 206, 86, 1)",
            "rgba(153, 102, 255, 1)",
            "rgba(255, 99, 132, 1)",
          ],
          borderWidth: 1,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      legend: {
        position: "right",
      },
    },
  });

  // Historical Data Chart
  var ctx2 = document.getElementById("historicalChart").getContext("2d");
  var historicalChart = new Chart(ctx2, {
    type: "line",
    data: {
      labels: ["January", "February", "March", "April"], // Update with dynamic labels if needed
      datasets: [
        {
          label: "Account Balance",
          data: [5000, 6000, 5500, 6200], // Replace with real historical data
          borderColor: "rgba(75, 192, 192, 1)",
          fill: false,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: { beginAtZero: true },
        y: { beginAtZero: true },
      },
    },
  });

  // Fetch and display Stock Buy/Sell Recommendations
  function fetchStockRecommendations() {
    fetch("{% url 'common:get_stock_recommendation' %}") // Replace with your actual Django view URL
      .then((response) => response.json())
      .then((data) => {
        document.getElementById("stock-recommendation").innerHTML =
          data.recommendation;
      })
      .catch((error) => {
        document.getElementById("stock-recommendation").innerHTML =
          "Failed to load recommendations.";
        console.error("Error fetching stock recommendations:", error);
      });
  }

  // Fetch and display Chatbot responses from the "Ask" button
  document
    .getElementById("chatbot-submit")
    .addEventListener("click", function () {
      const query =
        document.getElementById("chatbot-query").value ||
        document.getElementById("chat-input").value;

      // Clear the input fields after the query is submitted
      document.getElementById("chatbot-query").value = "";
      document.getElementById("chat-input").value = "";

      fetch("{% url 'common:get_chatbot_response' %}", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": "{{ csrf_token }}",
        },
        body: JSON.stringify({ query: query }),
      })
        .then((response) => response.json())
        .then((data) => {
          document.getElementById("chatbot-response").innerHTML = data.response;
        })
        .catch((error) => {
          document.getElementById("chatbot-response").innerHTML =
            "Failed to load chatbot response.";
          console.error("Error fetching chatbot response:", error);
        });
    });

  // Call fetch functions when the page loads
  fetchStockRecommendations();
</script>
{% endblock %}
